<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Browse Books - The Lit Lounge</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <header class="site-header">
    <nav class="nav container">
      <a class="brand" href="index.html">The Lit Lounge</a>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="browse.html" aria-current="page">Browse</a>
        <a href="about.html">About</a>
        <a href="cart.html">Cart</a>
        <a href="contact.html">Contact</a>
      </div>
    </nav>
  </header>

  <main class="container">
    <section class="section">
      <div class="section-head">
        <h1 class="page-title">Browse All Books</h1>
        <p class="muted">Search, sort, and view details before adding to cart.</p>
      </div>

      <!-- Controls -->
      <div class="controls">
        <label class="control">
          <span class="control-label">Search</span>
          <input id="searchInput" type="search" placeholder="Search title or author..." />
        </label>

        <label class="control">
          <span class="control-label">Sort</span>
          <select id="sortSelect">
            <option value="featured">Featured</option>
            <option value="price-asc">Price: Low → High</option>
            <option value="price-desc">Price: High → Low</option>
            <option value="title-asc">Title: A → Z</option>
            <option value="title-desc">Title: Z → A</option>
          </select>
        </label>
      </div>

      <!-- Book Grid (rendered by JS) -->
      <div id="bookGrid" class="book-grid"></div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <p>&copy; 2025 The Lit Lounge. All rights reserved.</p>
    </div>
  </footer>

  <!-- Modal -->
  <div id="bookModal" class="modal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-head">
        <h2 id="modalTitle"></h2>
        <button class="icon-btn" onclick="closeModal()" aria-label="Close">✕</button>
      </div>
      <p id="modalDescription" class="muted"></p>
      <div class="modal-actions">
        <button class="btn" onclick="closeModal()">Close</button>
      </div>
    </div>
  </div>

  <script>
    // Single source of truth for your catalog (easy to expand later)
    const books = [
      {
        key: "emberlight",
        title: "Whispers of the Emberlight",
        author: "Mira Thorne",
        price: 14.99,
        img: "images/book1.png",
        description: "A fantasy tale of rebellion and magic buried beneath the ashes of war."
      },
      {
        key: "hollowsky",
        title: "Beneath a Hollow Sky",
        author: "Elias Varrin",
        price: 12.49,
        img: "images/book2.png",
        description: "In a world without stars, a cartographer unearths a signal that could reshape time itself."
      },
      {
        key: "clockmaker",
        title: "The Clockmaker's Silence",
        author: "Renata Vale",
        price: 16.25,
        img: "images/book3.png",
        description: "A journalist follows a trail of clues left by a mysterious clockmaker in 1890s Prague."
      }
    ];

    const grid = document.getElementById("bookGrid");
    const searchInput = document.getElementById("searchInput");
    const sortSelect = document.getElementById("sortSelect");

    function money(n){ return `$${n.toFixed(2)}`; }

    function render(list){
      grid.innerHTML = list.map(b => `
        <article class="book-card">
          <img src="${b.img}" alt="${b.title} cover" />
          <h3>${b.title}</h3>
          <p class="muted">${b.author}</p>

          <div class="book-bottom">
            <span class="price">${money(b.price)}</span>
            <div class="card-actions">
              <button class="btn small ghost" onclick="openModal('${b.key}')">View</button>
              <button class="btn small" onclick="addToCart('${escapeQuotes(b.title)}', ${b.price})">Add</button>
            </div>
          </div>
        </article>
      `).join("");
    }

    function escapeQuotes(str){
      // helps keep onclick safe for single quotes
      return String(str).replaceAll("'", "\\'");
    }

    function applyFilters(){
      const q = searchInput.value.trim().toLowerCase();
      let filtered = books.filter(b =>
        b.title.toLowerCase().includes(q) || b.author.toLowerCase().includes(q)
      );

      const sort = sortSelect.value;
      if (sort === "price-asc") filtered.sort((a,b)=>a.price-b.price);
      if (sort === "price-desc") filtered.sort((a,b)=>b.price-a.price);
      if (sort === "title-asc") filtered.sort((a,b)=>a.title.localeCompare(b.title));
      if (sort === "title-desc") filtered.sort((a,b)=>b.title.localeCompare(a.title));

      render(filtered);
    }

    // Modal
    function openModal(bookKey){
      const b = books.find(x => x.key === bookKey);
      document.getElementById("modalTitle").textContent = b.title;
      document.getElementById("modalDescription").textContent = b.description;
      const m = document.getElementById("bookModal");
      m.style.display = "block";
      m.setAttribute("aria-hidden", "false");
    }

    function closeModal(){
      const m = document.getElementById("bookModal");
      m.style.display = "none";
      m.setAttribute("aria-hidden", "true");
    }

    // Cart
    function addToCart(title, price){
      const item = { title, price, qty: 1 };
      let cart = JSON.parse(localStorage.getItem("cart")) || [];

      const existing = cart.find(book => book.title === title);
      if (existing) existing.qty += 1;
      else cart.push(item);

      localStorage.setItem("cart", JSON.stringify(cart));
      alert(`${title} added to cart.`);
    }

    // Events
    searchInput.addEventListener("input", applyFilters);
    sortSelect.addEventListener("change", applyFilters);

    // Initial render
    render(books);

    // Close modal if clicking the backdrop
    document.getElementById("bookModal").addEventListener("click", (e) => {
      if (e.target.id === "bookModal") closeModal();
    });
  </script>
</body>
</html>
